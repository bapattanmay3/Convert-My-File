{% extends "base.html" %}
{% block content %}
<h1>ðŸ“‘ PDF Merger</h1>
<p class="tagline">Combine multiple PDF documents into a single professional file</p>

<div class="converter-card">
    <form id="merge-form" action="/merge" method="POST" enctype="multipart/form-data">
        <div class="upload-area" onclick="document.getElementById('file-upload').click()">
            <span class="upload-icon">ðŸ“š</span>
            <div class="btn-premium" style="padding: 10px 25px; margin-bottom: 10px;">Select PDF Files</div>
            <p style="color: var(--text-muted);">Choose 2 or more PDF files</p>
            <input id="file-upload" name="files" type="file" accept=".pdf" multiple onchange="handleFileSelect(this)"
                hidden />
        </div>

        <div id="file-list" style="margin-top: 20px; text-align: left; max-height: 250px; overflow-y: auto;"></div>

        <button type="submit" id="submit-btn" class="btn-premium" style="width: 100%; margin-top: 30px;" disabled>
            <span>Merge PDFs</span>
        </button>
    </form>

    <div id="status-msg" style="margin-top: 20px; display: none; color: var(--primary); text-align: center;">
        <span class="loading-dots">Merging documents</span>
    </div>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div
        style="margin-top: 20px; padding: 15px; border-radius: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); color: #ef4444; text-align: center;">
        {% for message in messages %}
        <p>{{ message }}</p>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
</div>

<style>
    .file-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        margin-bottom: 10px;
        border: 1px solid var(--glass-border);
    }

    .loading-dots:after {
        content: '.';
        animation: dots 1.5s steps(5, end) infinite;
    }

    @keyframes dots {

        0%,
        20% {
            content: '.';
        }

        40% {
            content: '..';
        }

        60% {
            content: '...';
        }

        80%,
        100% {
            content: '';
        }
    }
</style>

<script>
    const form = document.getElementById('merge-form');
    const submitBtn = document.getElementById('submit-btn');
    const statusMsg = document.getElementById('status-msg');
    const fileList = document.getElementById('file-list');

    function handleFileSelect(input) {
        fileList.innerHTML = '';
        if (input.files && input.files.length > 0) {
            Array.from(input.files).forEach(file => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <span style="font-size: 0.95rem; font-weight: 500; color: #ffffff;">${file.name}</span>
                    <span style="color: var(--text-muted); font-size: 0.8rem;">${(file.size / 1024).toFixed(1)} KB</span>
                `;
                fileList.appendChild(item);
            });

            if (input.files.length >= 2) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        } else {
            submitBtn.disabled = true;
        }
    }

    form.onsubmit = () => {
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.7';
        submitBtn.querySelector('span').textContent = 'Merging...';
        statusMsg.style.display = 'block';
    };
</script>
{% endblock %}