{% extends "base.html" %}
{% block content %}
<h1>üåç Translator</h1>
<p class="tagline">High-Fidelity Document Translation across 100+ Languages</p>

<div class="converter-card">
    <form id="translate-form" action="/translate" method="POST" enctype="multipart/form-data">
        <div class="upload-area" onclick="document.getElementById('file-upload').click()">
            <span class="upload-icon">üìÑ</span>
            <div class="btn-premium" style="padding: 10px 25px; margin-bottom: 10px;">Select Document</div>
            <p style="color: var(--text-muted);">PDF, DOCX, or TXT</p>
            <input id="file-upload" name="file" type="file" accept=".pdf,.docx,.txt" onchange="handleFileSelect(this)"
                hidden />
        </div>

        <div id="file-info" class="file-info" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span id="display-name" style="font-weight: 600;"></span>
                <span id="display-size" style="color: var(--text-muted); font-size: 0.85rem;"></span>
            </div>
        </div>

        <div style="margin-top: 30px; text-align: left;">
            <div class="option-group">
                <label style="color: var(--text-muted); font-size: 0.9rem; font-weight: 500;">Target Language</label>
                <select name="target_lang" class="form-select" required>
                    {% for code, name in languages.items() %}
                    <option value="{{ code }}" {% if code=='en' %}selected{% endif %}>{{ name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <button type="submit" id="submit-btn" class="btn-premium" style="width: 100%; margin-top: 30px;">
            <span>Translate & Download</span>
        </button>
    </form>

    <div id="status-msg" style="margin-top: 20px; display: none; color: var(--primary); text-align: center;">
        <span class="loading-dots">Processing translation</span>
    </div>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div
        style="margin-top: 20px; padding: 15px; border-radius: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); color: #ef4444; text-align: center;">
        {% for message in messages %}
        <p>{{ message }}</p>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
</div>

<style>
    .loading-dots:after {
        content: '.';
        animation: dots 1.5s steps(5, end) infinite;
    }

    @keyframes dots {

        0%,
        20% {
            content: '.';
        }

        40% {
            content: '..';
        }

        60% {
            content: '...';
        }

        80%,
        100% {
            content: '';
        }
    }
</style>

<script>
    const form = document.getElementById('translate-form');
    const submitBtn = document.getElementById('submit-btn');
    const statusMsg = document.getElementById('status-msg');

    function handleFileSelect(input) {
        const fileInfo = document.getElementById('file-info');
        const displayName = document.getElementById('display-name');
        const displaySize = document.getElementById('display-size');

        if (input.files && input.files[0]) {
            const file = input.files[0];
            displayName.textContent = file.name;
            displaySize.textContent = (file.size / 1024).toFixed(1) + ' KB';
            fileInfo.style.display = 'block';
        } else {
            fileInfo.style.display = 'none';
        }
    }

    form.onsubmit = () => {
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.7';
        submitBtn.querySelector('span').textContent = 'Translating...';
        statusMsg.style.display = 'block';
    };
</script>
{% endblock %}