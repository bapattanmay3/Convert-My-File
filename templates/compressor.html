{% extends "base.html" %}
{% block content %}
<h1>ðŸ“‰ Compressor</h1>
<p class="tagline">Reduce file size while maintaining quality for PDF and Images</p>

<div class="converter-card">
    <form id="compress-form" action="/compress" method="POST" enctype="multipart/form-data">
        <div class="upload-area" onclick="document.getElementById('file-upload').click()">
            <span class="upload-icon">ðŸ“‰</span>
            <div class="btn-premium" style="padding: 10px 25px; margin-bottom: 10px;">Select File</div>
            <p style="color: var(--text-muted);">PDF, JPG, PNG or WebP</p>
            <input id="file-upload" name="file" type="file" accept=".pdf,.jpg,.jpeg,.png,.webp"
                onchange="handleFileSelect(this)" hidden />
        </div>

        <div id="file-info" class="file-info" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span id="display-name" style="font-weight: 600;"></span>
                <span id="display-size" style="color: var(--text-muted); font-size: 0.85rem;"></span>
            </div>
        </div>

        <div style="margin-top: 30px; text-align: left;">
            <div class="option-group">
                <label
                    style="color: var(--text-muted); font-size: 0.95rem; font-weight: 500; display: flex; justify-content: space-between;">
                    Compression Quality
                    <span id="quality-label" style="color: var(--primary);">60%</span>
                </label>
                <input type="range" name="quality" min="10" max="90" value="60" oninput="updateQuality(this.value)"
                    style="width: 100%; height: 6px; background: #1e293b; border-radius: 5px; -webkit-appearance: none; outline: none; margin-top: 15px;">
            </div>
        </div>

        <button type="submit" id="submit-btn" class="btn-premium" style="width: 100%; margin-top: 30px;" disabled>
            <span>Compress & Download</span>
        </button>
    </form>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div
        style="margin-top: 20px; padding: 15px; border-radius: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); color: #ef4444; text-align: center;">
        {% for message in messages %}
        <p>{{ message }}</p>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
</div>

<style>
    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        background: var(--primary);
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(255, 107, 74, 0.4);
    }
</style>

<script>
    const form = document.getElementById('compress-form');
    const submitBtn = document.getElementById('submit-btn');
    const qualityLabel = document.getElementById('quality-label');

    function updateQuality(val) {
        qualityLabel.textContent = val + '%';
    }

    function handleFileSelect(input) {
        const fileInfo = document.getElementById('file-info');
        const displayName = document.getElementById('display-name');
        const displaySize = document.getElementById('display-size');

        if (input.files && input.files[0]) {
            const file = input.files[0];
            displayName.textContent = file.name;
            displaySize.textContent = (file.size / 1024).toFixed(1) + ' KB';
            fileInfo.style.display = 'block';
            submitBtn.disabled = false;
        } else {
            fileInfo.style.display = 'none';
            submitBtn.disabled = true;
        }
    }

    form.onsubmit = () => {
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.7';
        submitBtn.querySelector('span').textContent = 'Compressing...';
    };
</script>
{% endblock %}